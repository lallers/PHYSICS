%/////////////////////////////////////////////////////////
% By: Lee Allers                                         /
%For: Physics Junior Lab, 2016                           /
%     University of New Mexico                           /
%/////////////////////////////////////////////////////////
clc; close all; clear all; format short eng

p1F = [0.931000000000000 1.67600000000000 2.42100000000000 3.91200000000000 6.33300000000000 10.0580000000000 15.8320000000000 25.1460000000000 39.8610000000000 63.1440000000000 100.024000000000 158.511000000000 251.271000000000 398.047000000000 630.878000000000 1000.05000000000 1584.92000000000 2511.96000000000 3981.03000000000 6309.52000000000 9999.98000000000];
p1A = [0.00700000000000000 0.00400000000000000 0 0.00400000000000000 0.00100000000000000 0.00100000000000000 0 -0.0120000000000000 -0.0300000000000000 -0.0850000000000000 -0.222000000000000 -0.515000000000000 -1.18400000000000 -2.50200000000000 -4.71900000000000 -7.74900000000000 -11.2440000000000 -15.0240000000000 -18.9230000000000 -22.8480000000000 -26.8120000000000];
p1P = [-.11 -0.110000000000000 -0.149000000000000-0.252000000000000 -0.430000000000000 -0.835000000000000 -1.34900000000000 -2.03200000000000 -3.18200000000000 -5.06000000000000 -7.90000000000000 -12.4840000000000 -19.2310000000000 -28.9450000000000 -41.3130000000000 -54.2070000000000 -65.2550000000000 -73.4850000000000 -78.9780000000000 -82.6580000000000 -85.2590000000000 -86.0310000000000];


R = 1070; % 100Ohm
C =  .0000003308; % 470nF
R2 = 1077.4;
C2 = .0000003322;
Ralt = 682.4260;


f=logspace(0,5,200);
w=2*pi*f;
p=-1/(R*C);
u=-20*log10(sqrt(1+(w*R*C).^2)); 
u2 = atan(-1*w*R*C);
w0 = 1/(R*C);
w0 = sprintf('Cuttof @ %g Hz, -3 dB',-p);

figure('units','normalized','position',[.1 .1 .5 .8])
subplot(2,1,1)
h=semilogx(f,u); 
hold on;
plot(p1F,p1A,'rx')
wn=-p;
plot([wn/(2*pi) wn/(2*pi)], [0,-80],'k--');
text(wn/(2*pi),5,w0);
f1=-p/(2*pi);
fmax=max(f);
asymp=-20*log10((fmax-f1)/f1);
plot([min(f) f1 fmax],[0 0 asymp ],'k--');

poles=[-p -p];
figure(1);
hold on
grid off;
axis([0 max(f) -80 40]);
xlabel('Frequency (Hz)'); ylabel('Amplitude (dB)');
t=['Bode Plot of, C=' num2str(C*1e9) 'nF, R=' num2str(R) '\Omega'];
title(t, 'fontsize', 15);
legend('Theory','Data')
hold off;

subplot(2,1,2)
u2 = rad2deg(atan(-1*w*R*C));
g=semilogx(f,u2);
hold on;
plot(p1F,p1P,'rx')
xlabel('Frequency (Hz)'); ylabel('Phase (\phi)');
axis([0 max(f) -100 0 ]);
legend('Theory','Data')




